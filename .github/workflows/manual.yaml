name: Manual
on: 
  workflow_dispatch:
    inputs:
      name:
        type: string
        required: true
        description: please write your name
        default: Ken
      feeling:
        type: choice
        options:
          - happy
          - sad
          - hungry
        description: How are you feeling right now?

concurrency:
  group: ${{ github.workflow }}-${{github.ref}}
  cancel-in-progress: true

jobs:
  job-1:
    runs-on: ubuntu-latest      
    timeout-minutes: 3
    steps:
    - name: sleep if necessary
      if: ${{ inputs.name == 'Ken' }} 
      run: |
        echo sleep 4 minutes if inputs name == default value
        sleep 240
    
    - name: greet (read inputs)
      run: echo "Hello, ${{ inputs.name }}!! You are ${{ inputs.feeling }} now."
        
    - name: description
      run: echo "This workflow was triggered by ${{ github.actor }} on ${{ github.ref_name }}."

  job-2:
    runs-on: ubuntu-latest      
    steps:
    - name: 2 job (upload and download artifact which is file created in workfile)
      run: |
        sleep 30
        echo "This is job-2" && echo "Hello! ${{ github.repository_owner }} in ${{ github.repository }}. ${date}" > sample.txt
    - uses: actions/upload-artifact@v4
      with:
        name: sample-artifact
        path: sample.txt
        retention-days: 3

  job-3:
    runs-on: ubuntu-latest
    steps:
    - name: 3 job (write and read GITHUB_OUTPUT, write outputs)
      id: third-job-id
      run: |
        echo "hoge=abc" >> "${GITHUB_OUTPUT}"
        sleep 30 && echo "This is job-3"
    - env:
        TEST_RESULT: ${{ steps.third-job-id.outputs.hoge }}
      run: echo "${TEST_RESULT}" && echo "hoge=xyz" >> "${GITHUB_OUTPUT}"
    outputs:
      test: ${{ steps.third-job-id.outputs.hoge }}

  job-4:
    runs-on: ubuntu-latest
    needs: [job-3]
    steps:
    - name: 4 job (read outputs)
      env:
        JOB_3_RESULT: ${{ needs.job-3.outputs.test.hoge }}
      run: | 
        sleep 30 && echo "This is job-4, job-3's result => ${JOB_3_RESULT}"
        echo github.event_name = ${{ github.event_name }}
        echo runner.name = ${{ runner.name }}

  job-5:
    runs-on: ubuntu-latest
    needs: [job-2]
    steps:
      - name: download artifact (= file created in workfile) in different job
        uses: actions/download-artifact@v4
        with:
          name: sample-artifact
          path: test-downloaded
      - run: cat test-downloaded/sample.txt
